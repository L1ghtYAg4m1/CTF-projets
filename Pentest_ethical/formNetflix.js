const { Builder, By, until } = require('selenium-webdriver');
const chrome = require('selenium-webdriver/chrome');

async function analyzeNetflixFormSubmission() {
    let options = new chrome.Options();
    options.addArguments('--headless'); // Run in headless mode
    options.addArguments('--disable-gpu');
    options.addArguments('--window-size=1280x800');
    options.setLoggingPrefs({ performance: 'ALL' }); // Enable performance logging

    let driver = await new Builder()
        .forBrowser('chrome')
        .setChromeOptions(options)
        .build();

    try {
        await driver.get('https://www.netflix.com/fr/LoginHelp');

        // Wait for and interact with the form elements
        const smsRadioButton = await driver.wait(until.elementLocated(By.css('label[for="bxid_resetPasswordChoice_text"]')), 5000);
        await driver.executeScript("arguments[0].click();", smsRadioButton);

        const phoneInput = await driver.wait(until.elementLocated(By.css('#forgot_password_input')), 5000);
        await phoneInput.sendKeys('+33783305798');

        const submitButton = await driver.wait(until.elementLocated(By.css('button[data-uia="action_forgot_password"]')), 5000);
        await driver.executeScript("arguments[0].click();", submitButton);

        // Wait for a few seconds to ensure form submission
        await driver.sleep(5000);

        // Retrieve and log performance logs (including network requests)
        const logs = await driver.manage().logs().get('performance');
        for (let entry of logs) {
            const message = JSON.parse(entry.message).message;
            if (message.method === 'Network.requestWillBeSent') {
                console.log('Request URL:', message.params.request.url);
                console.log('Request Method:', message.params.request.method);
                if (message.params.request.postData) {
                    console.log('Request Post Data:', message.params.request.postData);
                }
            }
        }

        console.log("Form submitted successfully.");
    } catch (error) {
        console.error(`Error during form submission: ${error}`);
    } finally {
        await driver.quit();
    }
}

// Run the function
analyzeNetflixFormSubmission().catch(console.error);
