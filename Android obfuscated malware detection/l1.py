import pandas as pd
from sklearn.preprocessing import LabelEncoder
from sklearn.svm import LinearSVC
from sklearn.feature_selection import SelectFromModel
from sklearn.impute import SimpleImputer

# Load the dataset
df = pd.read_csv('features.csv')  # Ensure 'features.csv' is your dataset file, or change the path accordingly

# Extract the target labels from the 'Label' column and convert them to numerical values
label_encoder = LabelEncoder()
df['Label'] = label_encoder.fit_transform(df['Label'])  # Transform 'malware' and 'benign' to 1 and 0 respectively

# Separate features and target
target = df['Label'].values  # Target labels as an array
df = df.drop(columns=['Label'])  # Features without the label column

# Impute missing values (fill NaNs with the mean of each column)
imputer = SimpleImputer(strategy='mean')
df_imputed = imputer.fit_transform(df)

# Perform L1 feature selection
lsvc = LinearSVC(C=0.01, penalty="l1", dual=False).fit(df_imputed, target)
model = SelectFromModel(lsvc, prefit=True)
X_new = model.transform(df_imputed)

print(X_new.shape)
print(model.get_support(indices=True))

# Save the selected features
selected_features = model.get_support(indices=True)
all_api_calls = list(df.columns)  # Assuming these are your feature names

with open('l1.txt', 'w') as f:
    for index in selected_features:
        f.write(all_api_calls[index] + "\n")
